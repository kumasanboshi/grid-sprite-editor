# CLAUDE.md

## Project
<!-- プロジェクト名と簡単な説明 -->
PROJECT_NAME - 説明

## Tech Stack
<!-- 使用技術を記載 -->
- Frontend:
- Backend:
- Database:
- API:

## Key Commands
```bash
# よく使うコマンドを記載
npm start          # 開発サーバー起動
npm run build      # ビルド
npm run test       # テスト実行
npm run lint       # リンター実行
```

## Project Structure
```
src/
├── components/    #
├── pages/         #
├── services/      #
├── hooks/         #
├── types/         #
├── utils/         #
└── constants/     #
```

## Important Files
- `docs/PROJECT.md` - プロジェクト詳細・要件
- `docs/ARCHITECTURE.md` - 技術設計・データモデル
- `docs/CONTRIBUTING.md` - コーディング規約・開発フロー

## Domain Terms
<!-- プロジェクト固有の用語を記載 -->
- **Term1**: 説明
- **Term2**: 説明

## Guidelines
- 不明点は確認してから実装
- 既存のコードスタイルを尊重
- **テスト駆動開発（TDD）を採用**

---

## ワークフロー厳守

**重要: 以下のルールを必ず守ること**

1. **テストが通った = 完了ではない**
   - STEP 3（実装）が終わっただけ
   - 必ず STEP 4〜7 を実行すること

2. **直接 main ブランチにプッシュしてはいけない**
   - 必ずフィーチャーブランチを作成
   - PR を作成してレビューを経てからマージ

3. **すべてのステップを実行する**
   - STEP 1: 探索
   - STEP 2: 計画
   - STEP 3: 実装（TDDサイクル）
   - STEP 4: 実装検証 ← **スキップ禁止**
   - STEP 5: PR作成 ← **スキップ禁止**
   - STEP 6: レビュー ← **スキップ禁止**
   - STEP 7: マージ

---

## Development Workflow（TDD）

各タスクは以下のステップで進める。

### STEP 1: 探索（Exploreエージェント / haiku）

| 内容 | 詳細 |
|------|------|
| 関連ファイル調査 | 既存コード、型定義、テストの確認 |
| 仕様確認 | PROJECT.mdの該当箇所を確認 |

### STEP 2: 計画（Planエージェント / sonnet or opus）

| 内容 | 詳細 |
|------|------|
| 仕様の不明点確認 | 不明点があればユーザーに確認 → PROJECT.mdに反映 |
| テスト設計 | テストケースの洗い出し（正常系・異常系・境界値） |
| 実装方針策定 | インターフェース設計、依存関係の整理 |

※ 複雑な設計判断が必要な場合は **opus** を使用

**計画に含めるべき内容:**
- テストファイルのパス
- テストケース一覧（describe/it構造）
- 実装ファイルのパス
- 関数シグネチャ（入出力の型）

### STEP 3: 実装（TDDサイクル）（/tdd スキル + test-designer / sonnet）

```
┌─────────────────────────────────────────────────────┐
│  3-1. テストを書く                                    │
│       期待する動作を明確にする                         │
│       ↓                                              │
│  3-2. テストの失敗を確認                              │
│       npm test でテストが失敗することを確認            │
│       ↓                                              │
│  3-3. テストをコミット                                │
│       テストの内容を固定（実装前にコミット）            │
│       ↓                                              │
│  3-4. 実装を書く                                      │
│       テストが通るように実装を作成                     │
│       ⚠️ テストコードは変更しない                      │
│       ↓                                              │
│  3-5. 実装をコミット                                  │
│       完成したコードを保存                            │
└─────────────────────────────────────────────────────┘
```

### STEP 4: 実装検証（独立サブエージェント / haiku or sonnet）

テストがすべて通ったら、**独立したサブエージェント**で以下を検証:

| 検証項目 | 内容 |
|----------|------|
| テスト依存性 | テストに過度に依存した実装になっていないか |
| エッジケース | テストでカバーされていないケースはないか |
| コード品質 | 可読性、保守性、パフォーマンスの観点 |
| 設計原則 | SOLID原則、DRY原則への準拠 |

### STEP 5: PR作成（Bashエージェント）

| 内容 | 詳細 |
|------|------|
| 型チェック | `npx tsc --noEmit` |
| 全テスト実行 | `npm test` |
| PR作成 | テストと実装の両方を含むPR |

### STEP 6: レビュー & 指摘対応（sonnet or opus + Codex）

#### ダブルレビュー（並列実行）

| レビュアー | 観点 |
|-----------|------|
| Claude Code サブエージェント | 仕様・ロジック検証 |
| Codex | 設計品質、コード品質、見落としの指摘 |

※ 複雑なロジックや重要な機能は **opus** で最終レビュー

#### 指摘対応

- 各レビューの指摘を確認
- 必要な修正を実施
- 修正後、再レビュー（必要に応じて）

### STEP 7: マージ

| 内容 | 詳細 |
|------|------|
| 最終確認 | 全レビュー指摘がクローズされていること |
| マージ | PRをマージ |
| ブランチ削除 | フィーチャーブランチを削除 |

---

## モデル使い分けの指針

| モデル | 用途 |
|--------|------|
| **haiku** | 単純な探索・チェック、高速フィードバック |
| **sonnet** | 通常の実装・テスト・検証 |
| **opus** | 複雑な設計判断、最終レビュー |

**opusを使う判断基準:**
- 仕様に曖昧な部分がある
- 複数のアーキテクチャ案のトレードオフ判断
- 複雑な相互作用の検証
- 最終レビューで品質を担保したい時

---

## TDDのルール

1. **Red → Green → Refactor**
   - Red: 失敗するテストを書く
   - Green: テストが通る最小限の実装
   - Refactor: コードを改善（テストは変更しない）

2. **テストファースト**
   - 実装前に必ずテストを書く
   - テストが仕様書の役割を果たす

3. **テストコードの不変性**
   - 実装フェーズでテストコードを変更しない
   - テストが間違っていた場合は新しいサイクルで修正

4. **小さなステップ**
   - 一度に1つの機能をテスト→実装
   - 複雑な機能は分割して段階的に実装

---

## サブエージェント一覧

| エージェント | 用途 |
|-------------|------|
| **Plan** | コードベース探索 + 実装計画 + テスト設計 |
| **Explore** | コードベース探索（調査のみ） |
| **Bash** | git操作、コマンド実行 |
| **general-purpose** | 実装検証、複雑なマルチステップタスク |
| **test-designer** | テストケースの設計とレビュー |
<!-- プロジェクト固有のエージェントを追加 -->

---

## スキル（カスタムコマンド）

| コマンド | 用途 |
|---------|------|
| **/tdd** | TDDサイクルを実行（テスト設計→テスト作成→実装→検証） |
<!-- プロジェクト固有のスキルを追加 -->

---

## テストファイル命名規則

```
src/__tests__/
├── {機能名}.test.ts      # サービス・ユーティリティのテスト
├── {コンポーネント名}.test.tsx  # コンポーネントのテスト
└── integration/          # 統合テスト
```

## コミットメッセージ規則

```
test: {機能名}のテストを追加
feat: {機能名}を実装
fix: {バグ内容}を修正
refactor: {対象}をリファクタリング
```

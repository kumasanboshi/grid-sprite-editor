# 機能仕様 - grid-sprite-editor

## 概要

ChatGPT 等のAIが生成したスプライトシート（N×M グリッドの PNG）を修正・編集するための Windows デスクトップアプリ。

主なユースケース：
- 3×3 スプライトシートでコマの絵が上下左右にズレている箇所を微調整
- コマが隣にはみ出してしまっている箇所をラッソ選択で修正
- 修正後に個別コマとして書き出してゲームエンジンに取り込む

---

## 機能一覧

### F-01: 画像読み込み・保存
- PNG ファイルをドラッグ&ドロップまたはファイルダイアログで開く
- 上書き保存・名前を付けて保存
- 透過（アルファチャンネル）を保持

### F-02: グリッド表示・設定
- N（列数）× M（行数）を数値入力で設定（デフォルト 3×3）
- グリッド線の色・透明度を変更可能
- グリッド表示/非表示の切り替え

### F-03: セル内ガイド線表示
- 各セルの中心を示す十字線（水平・垂直の中心線）を表示
- 上下左右のズレを視覚的に把握しやすくする
- ガイド線の表示/非表示の切り替え
- ガイド線の色・透明度を変更可能

### F-04: リサイズ
- N（または LCM(N,M)）で割り切れるサイズに変換
- プリセット（3×3 向け）:
  - 768 × 768（1コマ 256×256）
  - 1536 × 1536（1コマ 512×512）★推奨（ChatGPT の 1024×1024 からの変換先）
  - 1920 × 1920（1コマ 640×640）
  - 2400 × 2400（1コマ 800×800）
  - 3072 × 3072（1コマ 1024×1024）
- カスタムサイズ入力も可（割り切れない場合は警告）
- リサイズアルゴリズム: Lanczos（高品質）

### F-05: セル内コンテンツ移動（Alt + ドラッグ）
- `Alt` キーを押しながらドラッグすることで即座にアクティブになる
- クリックしたセルの画像コンテンツ全体を移動
- 画像外にはみ出た分はクリップ（消える）
- 隣セルとの入れ替えは行わない（純粋な位置微調整）
- セル内ガイド線（F-03）と組み合わせて中心合わせに使う

### F-06: 矩形選択
- マウスドラッグで矩形の選択範囲を作成
- 選択範囲をドラッグで移動
- 選択範囲のハンドルをドラッグして拡縮
- Delete キーで選択範囲を透明化

### F-07: ラッソ選択（自由形状）
- マウスドラッグで自由形状の選択範囲を描く
- 選択範囲をドラッグで移動
- Delete キーで選択範囲を透明化

### F-08: 消しゴム
- ブラシサイズ調整可能
- 塗った箇所を透明にする

### F-09: コマ単位入れ替え
- セルをクリックして選択 → 別のセルをクリックで入れ替え
- または専用ダイアログで入れ替え先を指定

### F-10: アニメーションプレビュー
- 全コマを指定 FPS で連続再生
- 再生/停止/コマ送り/コマ戻し
- FPS 設定（1〜60）
- ループ再生切り替え

### F-11: ズームイン/アウト
- マウスホイールまたはスライダーでズーム
- ズーム率: 25% 〜 800%
- 「実寸表示」「全体表示」ボタン

### F-12: Undo/Redo
- Ctrl+Z / Ctrl+Y（または Ctrl+Shift+Z）
- 履歴数: 最大 50 ステップ
- 編集操作すべてがアンドゥ対象

### F-13: 個別コマエクスポート
- 全セルを個別 PNG として書き出し
- ファイル名: `{元ファイル名}_{行}_{列}.png`（例: `sprite_0_0.png`）
- 出力先ディレクトリを選択

---

## UI レイアウト（概要）

```
┌──────────────────────────────────────────────┐
│ メニューバー: ファイル / 編集 / 表示 / ツール  │
├──────────┬───────────────────────┬────────────┤
│          │                       │  プロパティ │
│ツールバー│   キャンバス（メイン） │  パネル     │
│          │                       │            │
│ [矩形選択]│   スプライトシート   │ グリッド設定│
│ [ラッソ] │   + グリッドオーバーレイ│ N: [3] M: [3]│
│ [消しゴム]│   + セル内ガイド線   │            │
│ [移動]   │                       │ ガイド線    │
│ [コマ交換]│                      │ [表示切替]  │
│          │                       │            │
│          │                       │ ズーム      │
│          │                       │ [====○===] │
├──────────┴───────────────────────┴────────────┤
│ ステータスバー: 座標, ズーム率, 選択セル番号   │
└──────────────────────────────────────────────┘
```

---

## キーボードショートカット

| キー | 機能 |
|------|------|
| Ctrl+O | ファイルを開く |
| Ctrl+S | 上書き保存 |
| Ctrl+Shift+S | 名前を付けて保存 |
| Ctrl+Z | Undo |
| Ctrl+Y | Redo |
| Ctrl++ / Ctrl+- | ズームイン/アウト |
| Ctrl+0 | 全体表示 |
| Delete | 選択範囲を削除 |
| **Alt + ドラッグ** | **セル内コンテンツ移動（即時）** |
| V | 移動ツール |
| M | 矩形選択ツール |
| L | ラッソ選択ツール |
| E | 消しゴムツール |
| Space + ドラッグ | キャンバスパン |

---

## 技術スタック

| 項目 | 選定 | 理由 |
|------|------|------|
| 言語 | Python 3.11+ | 豊富なライブラリ、開発速度 |
| UI | PyQt6 | 高機能、Windows ネイティブ対応 |
| 画像処理 | Pillow | 標準的、扱いやすい |
| 配布 | PyInstaller | exe 化で依存なしに配布可能 |

---

## 未対応（将来検討）

- フリップ/回転（コマ単位）
- オニオンスキン（前後コマを半透明表示）
- グリッド線の手動ドラッグ調整
- PNG 以外のフォーマット対応
- Mac/Linux 対応
